// this code generates a small mario game

int x;
int y;
int vVel;
int hVel;
int left;
int right;
int up;
int down;
int gameFrame;
int lastPressedDir;

void start() {
	x = 0;
	y = 0;
	vVel = 0;
	left = 0;
	right = 0;
	gameFrame = 0;
}

int FP2I(int z) {
	ret z/16;
}

int I2FP(int z) {
	ret z*16;
}

int GetHighOutOfFour(int a, int b, int c, int d) {
	if (a > b && a > c && a > d) {
		ret 0;
	}
	if (b > a && b > c && b > d) {
		ret 1;
	}
	if (c > a && c > b && c > d) {
		ret 2;
	}
	ret 3;
}

void CheckCollision(int boxX, int boxY, int boxW, int boxH) {
	int topP; // can only decl at the beginning of funcs cuz my compiler isn't smart enough to do that automatically (in anything but high scope), therefore everything must at least be decl'd outside of lower scope
	int bottomP;
	int leftP;
	int rightP;
	int topVar;
	
	if ((FP2I(y) - FP2I(vVel)) + 32 > boxY && FP2I(y) - FP2I(vVel) < boxY + boxH && (FP2I(x) + FP2I(hVel)) + 32 > boxX && FP2I(x + hVel) < boxX + boxW) {
		topP = (boxY + boxH) - FP2I(y);
		bottomP = (FP2I(y) + 32) - boxY;
		leftP = (boxX + boxW) - FP2I(x);
		rightP = (FP2I(x) + 32) - boxX;
		topVar = GetHighOutOfFour(topP, bottomP, leftP, rightP);
		if (topVar == 0) { // top
			vVel = 0;
			y = I2FP(boxY - 32);
		} else if (topVar == 1) { // bottom
			vVel = 0;
			y = I2FP(boxY + boxH);
		} else if (topVar == 2) { // left
			hVel = 0;
			x = I2FP(boxX - 32);
		} else if (topVar == 3) { // right
			hVel = 0;
			x = I2FP(boxX + boxW);
		}
	} else {
	}
}

void DrawGame() {
	draw(3, 30, 30);
	draw(1, x/16, y/16);
}

void MainLoop() {
	vVel = vVel - 1;
	
	y = y - vVel;
	
	if (right) {
		hVel = hVel + 1;
	} else if (left) {
		hVel = hVel - 1;
	} else if (hVel > 0) {
		hVel = hVel - 1;
	} else if (hVel < 0) {
		hVel = hVel + 1;
	} else
		hVel = 0;
	
	x = x + hVel;
	
	if (y/16 > 100) {
		y = 100*16;
		vVel = 0;
	}
	
	CheckCollision(30, 30, 16, 16);
	
	
	clearScreen();
	DrawGame();
}

void Jump() {
	vVel = 2*16;
}

void OnKeyDown(int e) {
	if (e == 39) { // right
		right = 1;
	}
	if (e == 37) { // left
		left = 1;
	}
	if (e == 38) { // up
		up = 1;
		Jump();
	}
	if (e == 40) { // down
		down = 1;
	}
}

void OnKeyUp(int e) {
	if (e == 39) { // right
		right = 0;
	}
	if (e == 37) { // left
		left = 0;
	}
	if (e == 38) { // up
		up = 0;
	}
	if (e == 40) { // down
		down = 0;
	}
}

void OnClick(int nx, int ny) {
	// unused for now
	printInt(nx);
	printInt(ny);
}